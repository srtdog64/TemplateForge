<Window x:Class="TemplateForge.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TemplateForge - YAML 기반 프로젝트 구조 생성기" 
        Height="700" Width="1400"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <!-- 탭 스타일 -->
        <Style TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" BorderThickness="1,1,1,0" BorderBrush="#DEE2E6" 
                                CornerRadius="4,4,0,0" Margin="2,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0" x:Name="ContentSite"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Left"
                                                ContentSource="Header"
                                                Margin="10,4"/>
                                <Button Grid.Column="1" x:Name="CloseButton"
                                       Content="×" FontSize="14" FontWeight="Bold"
                                       Background="Transparent" BorderThickness="0"
                                       Foreground="#6C757D" Padding="4,0"
                                       VerticalAlignment="Center"
                                       Click="CloseTab_Click"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="White"/>
                                <Setter Property="Foreground" Value="#0078D4"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="#F8F9FA"/>
                                <Setter Property="Foreground" Value="#495057"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 상단: 타이틀바 -->
        <Border Grid.Row="0" Background="#0078D4" Padding="12,8">
            <DockPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <ComboBox x:Name="TemplateSpaceCombo" Width="200" Margin="0,0,10,0"
                             SelectionChanged="TemplateSpace_SelectionChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <Button Content="➕ New Space" Padding="8,4" Background="#28A745" 
                           Foreground="White" Click="NewSpace_Click"/>
                </StackPanel>
                <TextBlock Text="TemplateForge - Multi-YAML Template Space Editor" 
                          Foreground="White" FontWeight="SemiBold" FontSize="14"/>
            </DockPanel>
        </Border>

        <!-- 툴바 -->
        <ToolBar Grid.Row="1" Height="36" Background="#F8F9FA">
            <Button x:Name="NewProjectBtn" Content="🆕 새 프로젝트" Padding="8,4" Margin="2" 
                   ToolTip="템플릿에서 새 프로젝트 생성" Click="NewProject_Click"/>
            <Button x:Name="LoadYamlBtn" Content="📂 불러오기" Padding="8,4" Margin="2"
                   ToolTip="YAML 파일 불러오기" Click="LoadYaml_Click"/>
            <Separator/>
            <Button x:Name="AddDocumentBtn" Content="➕ 문서 추가" Padding="8,4" Margin="2"
                   ToolTip="현재 스페이스에 새 YAML 문서 추가" Click="AddDocument_Click"/>
            <Button x:Name="LinkDocumentsBtn" Content="🔗 연결 생성" Padding="8,4" Margin="2"
                   ToolTip="참조된 문서 자동 생성" Click="LinkDocuments_Click"/>
            <Separator/>
            <Button x:Name="SaveSpaceBtn" Content="💾 저장" Padding="8,4" Margin="2"
                   ToolTip="템플릿스페이스 저장" Click="SaveSpace_Click"/>
            <Button x:Name="ExportBtn" Content="📤 내보내기" Padding="8,4" Margin="2"
                   ToolTip="폴더 구조로 내보내기" Click="Export_Click"/>
            <Separator/>
            <Button x:Name="GenerateBtn" Content="🚀 Generate" Padding="8,4" Margin="2"
                   Background="#2196F3" Foreground="White" FontWeight="Bold"
                   ToolTip="프로젝트 구조 생성" Click="Generate_Click"/>
        </ToolBar>

        <!-- 메인 콘텐츠 -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>
            
            <!-- 왼쪽: 문서 트리 및 템플릿 -->
            <Border Grid.Column="0" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="0,0,1,0">
                <DockPanel>
                    <!-- 문서 트리 헤더 -->
                    <Border DockPanel.Dock="Top" Background="#E9ECEF" BorderBrush="#DEE2E6" 
                           BorderThickness="0,0,0,1" Padding="8,6">
                        <TextBlock Text="📁 Template Space Documents" FontWeight="Bold" FontSize="12"/>
                    </Border>
                    
                    <!-- 문서 트리 -->
                    <TreeView x:Name="DocumentTree" Margin="4" BorderThickness="0"
                             SelectedItemChanged="DocumentTree_SelectedItemChanged">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Icon}" Margin="0,0,4,0"/>
                                    <TextBlock Text="{Binding Name}"/>
                                    <TextBlock Text=" *" Foreground="Red" 
                                              Visibility="{Binding IsModified, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                    
                    <!-- 하단: 설정 -->
                    <Border DockPanel.Dock="Bottom" Background="#F8F9FA" BorderBrush="#DEE2E6" 
                           BorderThickness="0,1,0,0">
                        <StackPanel Margin="8">
                            <TextBlock Text="출력 경로" FontWeight="Medium" Margin="0,0,0,4" FontSize="11"/>
                            <DockPanel>
                                <Button DockPanel.Dock="Right" Content="..." Width="24" Height="24" 
                                       Margin="4,0,0,0" Click="BrowseOutputPath_Click" FontSize="10"/>
                                <TextBox x:Name="OutputPathTextBox" Text="C:\temp\output" Padding="4" FontSize="11"/>
                            </DockPanel>
                        </StackPanel>
                    </Border>
                </DockPanel>
            </Border>

            <!-- 중앙: 탭 에디터 -->
            <DockPanel Grid.Column="1">
                <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#DEE2E6" 
                       BorderThickness="0,0,0,1" Padding="8,4">
                    <DockPanel>
                        <Button DockPanel.Dock="Right" Content="➕" Width="24" Height="24" 
                               ToolTip="새 탭 추가" Click="NewTab_Click"/>
                        <TextBlock Text="YAML Editor" FontWeight="SemiBold" FontSize="12" 
                                  VerticalAlignment="Center"/>
                    </DockPanel>
                </Border>
                
                <!-- 탭 컨트롤 -->
                <TabControl x:Name="EditorTabs" BorderThickness="0">
                    <TabItem Header="main.yaml">
                        <TextBox x:Name="YamlEditor" 
                                FontFamily="Consolas" 
                                FontSize="11"
                                AcceptsReturn="True" 
                                AcceptsTab="True"
                                VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Auto"
                                TextWrapping="NoWrap"
                                Background="White"
                                Padding="8"
                                BorderThickness="0"
                                TextChanged="YamlEditor_TextChanged"/>
                    </TabItem>
                </TabControl>
            </DockPanel>

            <!-- 오른쪽: 미리보기 및 검증 -->
            <Border Grid.Column="2" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1,0,0,0">
                <DockPanel>
                    <!-- 액션 버튼들 -->
                    <Border DockPanel.Dock="Top" Background="#E9ECEF" BorderBrush="#DEE2E6" 
                           BorderThickness="0,0,0,1" Padding="8,6">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="ValidateButton" Content="✅ Validate" Click="Validate_Click" 
                                   Padding="6,4" Margin="0,0,4,0" FontSize="11"/>
                            <Button x:Name="PreviewButton" Content="👁️ Preview" Click="Preview_Click" 
                                   Padding="6,4" Margin="0,0,4,0" FontSize="11"/>
                            <Button x:Name="DiagramButton" Content="📊 Diagram" Click="Diagram_Click" 
                                   Padding="6,4" FontSize="11"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 결과 탭 -->
                    <TabControl x:Name="ResultTabControl" BorderThickness="0">
                        <TabItem Header="📊 Structure">
                            <TreeView x:Name="StructureTree" Margin="4" FontFamily="Consolas" FontSize="10"/>
                        </TabItem>
                        <TabItem Header="🔗 References">
                            <ScrollViewer>
                                <TextBlock x:Name="ReferencesText" FontFamily="Consolas" FontSize="10" 
                                          Padding="8" TextWrapping="Wrap" Background="White"/>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="✅ Validation">
                            <ScrollViewer>
                                <TextBlock x:Name="ValidationResults" FontFamily="Consolas" FontSize="10" 
                                          Padding="8" TextWrapping="Wrap" Background="White"/>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="📁 Preview">
                            <ScrollViewer>
                                <TextBlock x:Name="GeneratedFiles" FontFamily="Consolas" FontSize="10" 
                                          Padding="8" TextWrapping="Wrap" Background="White"/>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>
                </DockPanel>
            </Border>
        </Grid>

        <!-- 하단: 상태바 -->
        <Border Grid.Row="3" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="0,1,0,0" Padding="8,4">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Ellipse Width="8" Height="8" Fill="#FFA500" VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusText" Text="Ready" Margin="6,0,0,0" FontSize="11"/>
                </StackPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <TextBlock x:Name="DocumentCountText" Text="Documents: 0" FontSize="11"/>
                    <TextBlock x:Name="SpaceNameText" Text="Space: None" Margin="16,0,0,0" FontSize="11"/>
                </StackPanel>
                <Border/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
